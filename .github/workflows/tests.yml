name: CI Completa - San Felipe Inmobiliaria

on:
  push:
    branches:
      - main
      - develop
  pull_request:
    types: [opened, synchronize, reopened]

jobs:
  # ======================================================
  # JOB 1: VALIDACIÃ“N DEL BACKEND (Express + TypeScript)
  # ======================================================
  backend_ci:
    name: Backend - Pruebas y Tipado (API)
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ“¦ Checkout del cÃ³digo
        uses: actions/checkout@v4

      - name: ğŸŸ¢ Configurar Node.js (VersiÃ³n 18+)
        uses: actions/setup-node@v4
        with:
          node-version: '20' # Usamos una versiÃ³n LTS reciente

      - name: âš™ï¸ Instalar dependencias del Backend
        # Se mueve al directorio del Backend y usa npm/yarn segÃºn lo que uses. Asumo npm por el package.json
        run: cd Backend-Inmobiliaria && npm install
        
      # El Backend usa TypeScript, la compilaciÃ³n verifica el tipado y la sintaxis.
      - name: ğŸ•µï¸â€â™€ï¸ Verificar Tipado (tsc) y Compilar
        run: cd Backend-Inmobiliaria && npm run build # Asumo que tienes un script 'build' en package.json
        
      # Si tienes pruebas unitarias en el Backend (ej: Jest, Supertest)
      - name: âœ… Ejecutar Pruebas del Backend
        # AsegÃºrate de que este comando estÃ© definido en tu package.json del Backend
        run: cd Backend-Inmobiliaria && npm test
        
      - name: ğŸ§¹ Ejecutar Linter (Opcional, si usas ESLint/TSLint)
        run: cd Backend-Inmobiliaria && npm run lint # Asumo un script 'lint'

  # ======================================================
  # JOB 2: VALIDACIÃ“N DEL FRONTEND (React Native + Expo)
  # ======================================================
  frontend_ci:
    name: Frontend - Pruebas y CompilaciÃ³n (Movil)
    runs-on: ubuntu-latest
    # Este job se ejecuta en paralelo con el backend_ci

    steps:
      - name: ğŸ“¦ Checkout del cÃ³digo
        uses: actions/checkout@v4

      - name: ğŸŸ¢ Configurar Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: âš™ï¸ Instalar dependencias del Movil
        # Usa yarn si tu lockfile es yarn.lock
        run: cd Movil-Inmobiliaria && npm install

      - name: âœ… Ejecutar Pruebas Unitarias del Movil (Jest)
        # Es crucial para validar los componentes y la lÃ³gica de estado (Zustand)
        run: cd Movil-Inmobiliaria && npm test
        
      - name: ğŸ§¹ Ejecutar Linter
        run: cd Movil-Inmobiliaria && npm run lint # Asumo un script 'lint'

      # --- VerificaciÃ³n de Tipado (TypeScript) ---
      # En proyectos Expo/RN con TypeScript, puedes verificar el tipado sin necesidad de compilar un binario.
      - name: ğŸ•µï¸â€â™€ï¸ Verificar Tipado del Frontend
        run: cd Movil-Inmobiliaria && npx tsc --noEmit # 'noEmit' verifica solo los errores sin generar JS

      # --- VerificaciÃ³n de CompilaciÃ³n Nativa (Android) ---
      # Esto asegura que el cÃ³digo nativo y las dependencias (Expo) estÃ¡n bien.
      - name: â˜• Configurar Java (para Android)
        uses: actions/setup-java@v4
        with:
          distribution: 'temurin'
          java-version: '17'
          
      - name: ğŸ”¨ Compilar Build de Android con Gradle (solo para verificar)
        # Esto valida que no haya errores de compilaciÃ³n nativa en Android.
        run: cd Movil-Inmobiliaria/android && ./gradlew assembleDebug